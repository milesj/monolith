---
slug: moon-v1.28
title: moon v1.28 - OS tasks, meta tokens, and more
authors: [milesj]
tags: [os, task, meta, token, toolchain]
# image: ./img/moon/v1.28.png
---

???

<!--truncate-->

## New OS specific tasks

When moon was originally designed, it was meant to be a very simple but easily configurable task
runner. But since then, moon has grown drastically, and so has the requirements of its users. One
such request was being able to define tasks that only run for certain operating systems.

This wasn't possible before; but is now thanks to the new
[`os` task option](/docs/config/project#os). This option can be configured with "linux", "macos", or
"windows" to target those specific systems, and can be a single value, or list of values.

```yaml title="moon.yml"
tasks:
  build-linux:
    command: 'cargo build --target x86_64-unknown-linux-gnu'
    options:
      os: 'linux'
  build-macos:
    command: 'cargo build --target x86_64-apple-darwin'
    options:
      os: 'macos'
  build-windows:
    command: 'cargo build --target x86_64-pc-windows-msvc'
    options:
      os: 'windows'
```

When a task is ran on a non-compatible system, it will be converted to a no-operation task, so that
dependency chains still resolve correctly.

> In the future, we will look into supporting system architecture as well.

## New `@meta` token function

In our last release, we introduced the [`project.metadata`](/docs/config/project#metadata-1) setting
as a means for consumers to define their own metadata. This is great but it provided no other
benefit, as it required consumers to open up config files to discover this metadata, or consumers to
write custom abstractions/tooling. We want to improve the integration of this information within
moon, so to start, we're introducing a new token function [`@meta(key)`](/docs/concepts/token#meta).

The [`@meta(key)`](/docs/concepts/token#meta) token function can be used to access project metdata
from both the [`project`](/docs/config/project#project) and
[`project.metadata`](/docs/config/project#metadata-1) settings. The former values will be used
as-is, while the latter values will be JSON stringified (since consumers can define anything).

With this new token, our task composition has grown even deeper. For example, you can define a task
at the top-level that a project inherits, and then define metadata within that project for the task!
With that said, this is more of a stopgap solution until we support true variables within
configuration.

```yaml title=".moon/tasks.yml"
tasks:
  build:
    script: 'compile --label @meta(name) --compress @meta(compression)'
```

```yaml title="<project>/moon.yml"
project:
  name: 'example'
  metadata:
    compression: 9
```

And lastly, while we're on the topic of tokens, we're also introducing `$projectName`,
`$projectChannel`, and `$projectOwner` token variables, as an easier alternative solution.

## Other changes

View the [official release](https://github.com/moonrepo/moon/releases/tag/v1.28.0) for a full list
of changes.

- We've sunset the CI insights feature in moonbase. We will no longer be tracking CI run history.
  This is a retroactive change that applies to all moon versions.
